CREATE TABLE Patient(
   IID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
   CIN VARCHAR(100) NOT NULL,
   Name VARCHAR(100) NOT NULL,
   Sex VARCHAR(500) NOT NULL,
   Birth DATE NOT NULL,
   Blood_group VARCHAR(10) NOT NULL,
   Phone VARCHAR(20),
   PRIMARY KEY (IID)
);

CREATE TABLE Contact_Location (
    CLID INT NOT NULL AUTO_INCREMENT,
    city VARCHAR(100) NOT NULL,
    province VARCHAR(100) NOT NULL,
    Street VARCHAR(500) NOT NULL,
    Number VARCHAR(10) NOT NULL,
    postal_code VARCHAR(10) NOT NULL,
    phone VARCHAR(20),
    PRIMARY KEY (CLID)
);

CREATE TABLE Have (
    IID INT NOT NULL,
    CLID INT NOT NULL,
    PRIMARY KEY (IID, CLID),
    FOREIGN KEY (IID) REFERENCES Patient(IID),
    FOREIGN KEY (CLID) REFERENCES Contact_Location(CLID)
);

CREATE TABLE Insurance (
    InsID INT NOT NULL AUTO_INCREMENT,
    ins_type VARCHAR(10) CHECK (type in ('CNOPS', 'CNSS', 'RAMED', 'private') OR type IS NULL),
);

CREATE TABLE Expenses(
   ExID INT NOT NULL,
   total FLOAT NOT NULL,
   InsID INT NOT NULL,

   FOREIGN KEY (InsID) REFERENCES Insurance(InsID);
);



CREATE TABLE Staff(
   STAFF_ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
   Name VARCHAR(100) NOT NULL,
   Status VARCHAR(20) NOT NULL
);
CREATE TABLE Practioner(
    Staff_ID INT PRIMARY KEY,
    License_Number INT NOT NULL,
    Specialty VARCHAR(100) NOT NULL,
    FOREIGN KEY(Staff_ID) REFERENCES Staff(Staff_ID)
);
CREATE TABLE Caregiving(
    Staff_ID INT PRIMARY KEY,
    Grade VARCHAR(50) NOT NULL,
    Ward VARCHAR(100) NOT NULL,
    FOREIGN KEY(Staff_ID) REFERENCES Staff(Staff_ID)
);
CREATE TABLE Technical(
    Staff_ID INT PRIMARY KEY,
    Modality VARCHAR(100) NOT NULL,
    Certifications VARCHAR(100) NOT NULL,
    FOREIGN KEY(Staff_ID) REFERENCES Staff(Staff_ID)
);
CREATE TABLE Department(
   DEP_ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
   Name VARCHAR(100) NOT NULL,
   Specialty VARCHAR(100) NOT NULL,
   HID INT UNIQUE NOT NULL,
   FOREIGN KEY(HID) REFERENCES Hospital(HID)
);
CREATE TABLE Hospital(
   HID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
   Name VARCHAR(100) NOT NULL,
   City VARCHAR(100) NOT NULL,
   Region VARCHAR(100) NOT NULL
);


CREATE TABLE Clinical_Activity (
    CAID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    Time TIME NOT NULL,
    Date DATE NOT NULL,
    STAFF_ID INT NOT NULL,
    IID INT NOT NULL,
    ExID INT NOT NULL,
    DEP_ID INT NOT NULL,
    PID INT UNIQUE,
    FOREIGN KEY (STAFF_ID) REFERENCES Staff(STAFF_ID),
    FOREIGN KEY (IID) REFERENCES Patient(IID),
    FOREIGN KEY (ExID) REFERENCES Expense(ExID),
    FOREIGN KEY (DEP_ID) REFERENCES Department(DEP_ID),
    FOREIGN KEY (PID) REFERENCES Prescription(PID)
);

CREATE TABLE Appointment (
    CAID INT PRIMARY KEY,
    Status VARCHAR(10) CHECK(type in ('Scheduled', 'Completed', 'Cancelled') or type is NULL) ,
    Reason VARCHAR(100) NOT NULL,
    FOREIGN KEY (CAID) REFERENCES Clinical_Activity(CAID)
);

CREATE TABLE Emergency (
    CAID INT PRIMARY KEY,
    Triage_Level VARCHAR(100) NOT NULL,
    Outcome VARCHAR(100) NOT NULL,
    FOREIGN KEY (CAID) REFERENCES Clinical_Activity(CAID)
);



CREATE TABLE Prescription(
   PID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
   Date_Issued DATE NOT NULL,
   PRIMARY KEY (PID),
   CAID INT NOT NULL,
   FOREIGN KEY (CAID) REFERENCES Clinical_Activity(CAID)
);

CREATE TABLE Medication (
    DrugID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    Class VARCHAR(100) NOT NULL,
    Name VARCHAR(100) NOT NULL,
    Form VARCHAR(100) NOT NULL,
    Strength VARCHAR(100) NOT NULL,
    Active_Ingredient VARCHAR(100) NOT NULL,
    Manufacturer VARCHAR(100) NOT NULL,
    PRIMARY KEY(DrugID)
);


CREATE TABLE Stock (
    HID INT NOT NULL,
    DrugID INT NOT NULL,
    Unit_Price DECIMAL(10,2) NOT NULL,
    Stock_Timestamp DATETIME NOT NULL,
    Quantity INT NOT NULL,
    Reorder_Level INT NOT NULL,
    PRIMARY KEY (HID, DrugID),
    FOREIGN KEY (HID) REFERENCES Hospital(HID),
    FOREIGN KEY (DrugID) REFERENCES Medication(DrugID)
);

CREATE TABLE include (
    PID INT NOT NULL,
    DrugID INT NOT NULL,
    PRIMARY KEY (PID, DrugID),
    FOREIGN KEY (PID) REFERENCES Prescription(PID),
    FOREIGN KEY (DrugID) REFERENCES Medication(DrugID)
);


CREATE TABLE work_in (
    STAFF_ID INT NOT NULL,
    DEP_ID INT NOT NULL,
    PRIMARY KEY (STAFF_ID, DEP_ID),
    FOREIGN KEY (STAFF_ID) REFERENCES Staff(STAFF_ID),
    FOREIGN KEY (DEP_ID) REFERENCES Department(DEP_ID)
);






